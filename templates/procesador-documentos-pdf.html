<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìÑ Procesador de PDFs - IA</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400;500;700&family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-cyan: #00ffff;
            --primary-blue: #00f2fe;
            --secondary-purple: #ff00cc;
            --secondary-indigo: #333399;
            --dark-bg: #0a0e1a;
            --card-bg: #1a2332;
            --accent-dark: #232526;
            --text-primary: #ffffff;
            --text-secondary: #b2fefa;
            --success-color: #00ffb3;
            --error-color: #ff3b3b;
            --warning-color: #ffe600;
            --invoice-green: #00e676;
            --invoice-orange: #ff9800;
            --invoice-blue: #2196f3;
            --ai-green: #39ff14;
            
            --glow-primary: 0 0 20px var(--primary-cyan);
            --glow-secondary: 0 0 15px var(--secondary-purple);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0,255,255,0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255,0,204,0.1) 0%, transparent 50%);
            min-height: 100vh;
            color: var(--text-primary);
            position: relative;
            overflow-x: hidden;
        }

        .bg-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            opacity: 0.6;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--primary-cyan);
            border-radius: 50%;
            animation: float 25s infinite linear;
            box-shadow: 0 0 6px var(--primary-cyan);
        }

        .particle.purple {
            background: var(--secondary-purple);
            box-shadow: 0 0 6px var(--secondary-purple);
        }

        .particle.green {
            background: var(--ai-green);
            box-shadow: 0 0 6px var(--ai-green);
        }

        .particle.orange {
            background: var(--invoice-orange);
            box-shadow: 0 0 6px var(--invoice-orange);
        }

        .particle.blue {
            background: var(--invoice-blue);
            box-shadow: 0 0 6px var(--invoice-blue);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-10vh) translateX(100px);
                opacity: 0;
            }
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--dark-bg);
            padding: 12px 30px;
            border-bottom: 1px solid var(--card-bg);
            position: relative;
            z-index: 10;
        }

        .logo {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--success-color);
            font-family: 'Orbitron', monospace;
        }

        .nav-tabs {
            display: flex;
            gap: 14px;
        }

        .nav-tab {
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: background 0.2s;
            font-size: 0.9em;
        }

        .nav-tab:hover {
            background: rgba(0, 255, 179, 0.1);
        }

        .nav-tab.active {
            background: var(--success-color);
            color: var(--dark-bg);
            font-weight: bold;
        }

        .status-info {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-container {
            padding: 15px 30px;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .page-title {
            text-align: center;
            margin-bottom: 15px;
        }

        .page-title h1 {
            font-family: 'Orbitron', monospace;
            font-size: 1.8em;
            font-weight: 900;
            color: var(--primary-cyan);
            margin-bottom: 5px;
            text-shadow: 0 0 15px var(--primary-cyan);
            animation: titlePulse 2s ease-in-out infinite alternate;
        }

        @keyframes titlePulse {
            0% { text-shadow: 0 0 15px var(--primary-cyan); }
            100% { text-shadow: 0 0 25px var(--primary-cyan), 0 0 35px var(--invoice-green); }
        }

        .page-title p {
            font-size: 0.9em;
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .file-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .file-item {
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(0,255,255,0.05) 100%);
            padding: 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(0,255,255,0.2);
            box-shadow: 0 6px 24px rgba(0,0,0,0.3);
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .file-item:hover::before {
            left: 100%;
        }

        .file-item:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 32px rgba(0,255,255,0.2);
            border-color: var(--primary-cyan);
        }

        .file-item.found {
            border-color: var(--success-color);
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(0,255,179,0.05) 100%);
        }

        .file-item.missing {
            border-color: var(--error-color);
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(255,59,59,0.05) 100%);
        }

        .file-icon {
            font-size: 1.5em;
            filter: drop-shadow(0 0 6px currentColor);
            animation: iconFloat 2s ease-in-out infinite alternate;
        }

        @keyframes iconFloat {
            0% { transform: translateY(0); }
            100% { transform: translateY(-2px); }
        }

        .file-name {
            font-family: 'Roboto Mono', monospace;
            font-size: 0.95em;
            font-weight: 500;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        .file-item.found .file-name {
            color: var(--success-color);
        }

        .file-item.missing .file-name {
            color: var(--error-color);
        }

        .separator {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary-cyan), var(--invoice-green), var(--invoice-orange), var(--primary-cyan), transparent);
            margin: 25px 0;
            border-radius: 2px;
            opacity: 0.7;
            animation: separatorPulse 3s ease-in-out infinite;
        }

        @keyframes separatorPulse {
            0%, 100% { opacity: 0.7; transform: scaleX(1); }
            50% { opacity: 1; transform: scaleX(1.01); }
        }

        .process-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .process-card {
            min-height: 340px;
            max-height: 340px;
            border-radius: 15px;
            padding: 20px;
            background: rgba(26, 35, 50, 0.95);
            border: 1px solid rgba(0,255,255,0.2);
            transition: var(--transition-bounce);
            position: relative;
            overflow: visible;
            display: flex;
            flex-direction: column;
        }

        .process-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-cyan), var(--invoice-green), var(--invoice-orange));
        }

        .process-card:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: var(--invoice-green);
            box-shadow: 0 15px 40px rgba(0,255,255,0.2);
        }

        .process-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary-cyan);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .process-description {
            color: var(--text-secondary);
            margin-bottom: 10px;
            line-height: 1.4;
            font-size: 0.9em;
            flex-grow: 0;
        }

        .process-file {
            font-size: 0.8em;
            color: var(--primary-blue);
            font-family: 'Roboto Mono', monospace;
            background: rgba(0,0,0,0.4);
            padding: 6px 10px;
            border-radius: 6px;
            margin-bottom: 12px;
            border: 1px solid rgba(0,255,255,0.2);
        }

        .upload-form {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex-grow: 1;
        }

        .upload-form input[type="file"] {
            width: 100%;
            padding: 8px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'Roboto Mono', monospace;
            font-size: 0.85em;
            transition: var(--transition-smooth);
        }

        .upload-form input[type="file"]:focus {
            outline: none;
            border-color: var(--primary-cyan);
            box-shadow: 0 0 0 2px rgba(0,255,255,0.1);
        }

        .control-btn {
            background: linear-gradient(135deg, var(--secondary-purple) 0%, var(--secondary-indigo) 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-family: 'Roboto Mono', monospace;
            font-size: 0.8em;
            transition: var(--transition-bounce);
            box-shadow: 0 3px 12px rgba(255,0,204,0.3);
        }

        .control-btn:hover:not(:disabled) {
            transform: translateY(-1px) scale(1.03);
            box-shadow: 0 5px 18px rgba(255,0,204,0.4);
        }

        .upload-status {
            font-size: 0.8em;
            font-weight: 500;
            min-height: 16px;
            text-align: center;
        }

        .execute-btn {
            background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--primary-blue) 100%);
            color: var(--dark-bg);
            border: none;
            padding: 12px 0;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-bounce);
            width: 100%;
            box-shadow: 0 6px 20px rgba(0,255,255,0.4);
            font-family: 'Roboto Mono', monospace;
            margin-top: auto;
            position: relative;
            overflow: hidden;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 2px solid transparent;
            flex-shrink: 0;
        }

        .execute-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.04);
            box-shadow: 0 12px 40px rgba(0,255,255,0.5);
            background: linear-gradient(135deg, var(--invoice-green) 0%, var(--primary-cyan) 100%);
            border-color: var(--invoice-green);
        }

        .execute-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            transition: var(--transition-smooth);
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .execute-btn:hover:not(:disabled)::before {
            width: 300px;
            height: 300px;
        }

        .execute-btn.processing {
            background: linear-gradient(135deg, var(--secondary-purple) 0%, var(--secondary-indigo) 100%);
            color: white;
            cursor: not-allowed;
            animation: processingPulse 1.5s ease-in-out infinite;
        }

        @keyframes processingPulse {
            0%, 100% { box-shadow: 0 6px 20px rgba(255,0,204,0.3); }
            50% { box-shadow: 0 6px 25px rgba(255,0,204,0.5); }
        }

        .controls {
            background: rgba(26, 35, 50, 0.95);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            border: 1px solid rgba(0,230,118,0.3);
        }

        .controls .control-btn {
            padding: 10px 20px;
            font-size: 0.9em;
            border-radius: 12px;
        }

        .clear-btn {
            background: transparent;
            color: var(--primary-cyan);
            border: 2px solid var(--primary-cyan);
            box-shadow: 0 4px 16px rgba(0,255,255,0.2);
        }

        .clear-btn:hover:not(:disabled) {
            background: var(--primary-cyan);
            color: var(--dark-bg);
        }

        .status {
            margin-left: auto;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary-cyan) 0%, var(--invoice-green) 100%);
            color: var(--dark-bg);
            border-radius: 15px;
            font-weight: 700;
            font-size: 0.9em;
            box-shadow: 0 4px 16px rgba(0,255,255,0.3);
            border: 2px solid rgba(0,255,255,0.5);
            font-family: 'Roboto Mono', monospace;
        }

        .status.processing {
            background: linear-gradient(135deg, var(--secondary-purple) 0%, var(--secondary-indigo) 100%);
            color: white;
            animation: statusPulse 2s infinite;
            border-color: var(--secondary-purple);
        }

        .status.error {
            background: linear-gradient(135deg, var(--error-color) 0%, #cc0000 100%);
            color: white;
            border-color: var(--error-color);
        }

        .status.success {
            background: linear-gradient(135deg, var(--success-color) 0%, var(--invoice-green) 100%);
            color: var(--dark-bg);
            border-color: var(--success-color);
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        .log-section {
            margin-top: 20px;
        }

        .log-title {
            font-size: 1.2em;
            font-weight: 700;
            color: var(--primary-cyan);
            margin-bottom: 15px;
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 8px var(--primary-cyan);
        }

        .log-container {
            background: rgba(0,0,0,0.6);
            border-radius: 12px;
            padding: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Roboto Mono', monospace;
            color: var(--primary-cyan);
            font-size: 0.9em;
            line-height: 1.5;
            box-shadow: 
                inset 0 0 15px rgba(0,0,0,0.5),
                0 0 30px rgba(0,255,255,0.1);
            border: 1px solid rgba(0,255,255,0.3);
        }

        .log-container::-webkit-scrollbar {
            width: 6px;
        }

        .log-container::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--primary-cyan), var(--invoice-green));
            border-radius: 3px;
        }

        .log-container::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
        }

        .log-entry {
            margin-bottom: 6px;
            padding: 2px 0;
            transition: var(--transition-smooth);
            animation: logEntrySlide 0.3s ease-out;
        }

        @keyframes logEntrySlide {
            from {
                transform: translateX(-8px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .log-entry.success { 
            color: var(--success-color); 
            text-shadow: 0 0 6px var(--success-color); 
        }

        .log-entry.error { 
            color: var(--error-color); 
            text-shadow: 0 0 6px var(--error-color); 
        }

        .log-entry.warning { 
            color: var(--warning-color); 
            text-shadow: 0 0 6px var(--warning-color); 
        }

        .log-entry.info { 
            color: var(--primary-cyan);
            text-shadow: 0 0 4px var(--primary-cyan); 
        }

        @media (max-width: 768px) {
            .header {
                padding: 10px 20px;
            }
            
            .main-container {
                padding: 10px 20px;
            }
            
            .page-title h1 {
                font-size: 1.5em;
            }
            
            .process-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }
            
            .status {
                margin-left: 0;
            }

            .file-status {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="bg-particles" id="bgParticles"></div>

    <div class="header">
        <div class="logo">IA</div>
        
        <div class="nav-tabs">
            <div class="nav-tab" onclick="navigateTo('index.html')">‚Üê Dashboard</div>
        </div>
        
        <div class="status-info">
            <div class="status-dot"></div>
            <span style="font-size: 0.9em; color: var(--text-secondary);">Procesador PDF Activo</span>
        </div>
    </div>

    <div class="main-container">
        <div class="page-title">
            <h1>Procesador de Documentos PDF</h1>
            <p>Automatizaci√≥n de Tecnolog√≠a - 6 Herramientas Especializadas</p>
        </div>

        <div class="file-status" id="fileStatus"></div>

        <div class="separator"></div>
        
        <div class="process-grid">
            <div class="process-card">
                <div class="process-title">üìÑ ERP Facturas</div>
                <div class="process-description">Procesar facturas del sistema ERP con an√°lisis autom√°tico de datos</div>
                <div class="process-file">Archivo: 1.ERP FC.py</div>
                <form class="upload-form" data-process="1.ERP FC.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('1.ERP FC.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>
            
            <div class="process-card">
                <div class="process-title">üõçÔ∏è Facturas MUISKA</div>
                <div class="process-description">Procesamiento de facturas MUISKA con validaci√≥n tributaria</div>
                <div class="process-file">Archivo: 2. FC MUISKA.py</div>
                <form class="upload-form" data-process="2. FC MUISKA.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('2. FC MUISKA.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>
            
            <div class="process-card">
                <div class="process-title">üè¶ Desprendibles Bancarios</div>
                <div class="process-description">An√°lisis de desprendibles bancarios y conciliaci√≥n autom√°tica</div>
                <div class="process-file">Archivo: 3.CE DESPRENDIBLES.py</div>
                <form class="upload-form" data-process="3.CE DESPRENDIBLES.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('3.CE DESPRENDIBLES.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>
            
            <div class="process-card">
                <div class="process-title">üìã ERP Comprobantes</div>
                <div class="process-description">Procesamiento de comprobantes de egreso del sistema ERP</div>
                <div class="process-file">Archivo: 4.CE ERP CONTABLE.py</div>
                <form class="upload-form" data-process="4.CE ERP CONTABLE.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('4.CE ERP CONTABLE.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>

            <div class="process-card">
                <div class="process-title">üîó FC Combinaci√≥n</div>
                <div class="process-description">Procesamiento combinado de facturas con m√∫ltiples fuentes</div>
                <div class="process-file">Archivo: 5.FC COMBINACION.py</div>
                <form class="upload-form" data-process="5.FC COMBINACION.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('5.FC COMBINACION.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>

            <div class="process-card">
                <div class="process-title">üîó CE Combinado</div>
                <div class="process-description">An√°lisis combinado de comprobantes de egreso</div>
                <div class="process-file">Archivo: 6 CE COMBINADO.py</div>
                <form class="upload-form" data-process="6 CE COMBINADO.py" enctype="multipart/form-data">
                    <input type="file" name="pdfFiles" multiple required accept=".pdf" />
                    <button type="submit" class="control-btn">üì§ Subir PDFs</button>
                    <span class="upload-status"></span>
                </form>
                <button class="execute-btn" onclick="runProcess('6 CE COMBINADO.py')">‚ñ∂Ô∏è Ejecutar</button>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn" id="stopBtn" onclick="stopProcess()" disabled>
                üõë Detener Proceso
            </button>
            <button class="control-btn" id="fastProcessBtn" onclick="runAllProcesses()">
                ‚ö° Procesar Todo
            </button>
            <button class="control-btn clear-btn" onclick="clearLog()">
                üóëÔ∏è Limpiar Log
            </button>
            <div class="status" id="statusText">üöÄ Sistema listo para procesar</div>
        </div>
        
        <div class="log-section">
            <div class="log-title">üìã Log de Procesamiento en Tiempo Real</div>
            <div class="log-container" id="logContainer">
                <div class="log-entry info">Sistema de procesamiento PDF iniciado correctamente ‚ú®</div>
            </div>
        </div>
    </div>

    <script>
        function createParticles() {
            const particlesContainer = document.getElementById('bgParticles');
            const particleCount = 20;
            const colors = ['', 'purple', 'green', 'orange', 'blue'];

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const colorClass = colors[Math.floor(Math.random() * colors.length)];
                particle.className = `particle ${colorClass}`;
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 25 + 's';
                particle.style.animationDuration = (20 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 16px 24px;
                border-radius: 12px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.1);
            `;

            switch(type) {
                case 'success':
                    notification.style.background = 'linear-gradient(135deg, #00ffb3, #00e676)';
                    break;
                case 'error':
                    notification.style.background = 'linear-gradient(135deg, #ff3b3b, #cc0000)';
                    break;
                case 'warning':
                    notification.style.background = 'linear-gradient(135deg, #ffe600, #ff9800)';
                    break;
                default:
                    notification.style.background = 'linear-gradient(135deg, #00ffff, #00e676)';
                    notification.style.color = '#0a0e1a';
            }

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }

        let currentProcess = null;
        let fastProcessing = false;
        let fastProcessQueue = [];
        let fastProcessIndex = 0;
        let fastProcessTimeout;
        let availableFiles = [];

        function formatTime() {
            const now = new Date();
            return now.toLocaleTimeString('es-ES', { 
                hour12: false, 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
        }

        function logMessage(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${formatTime()}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
            logMessage('üóëÔ∏è Log limpiado - Sistema reiniciado', 'info');
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('statusText');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        async function checkFileAvailability() {
            try {
                const response = await fetch('/check-files');
                const files = await response.json();
                availableFiles = files;
                displayFileStatus();
                
                const foundFiles = availableFiles.filter(f => f.exists).length;
                const totalFiles = availableFiles.length;
                
                if (foundFiles === totalFiles) {
                    logMessage('‚úÖ Todos los procesadores PDF est√°n operativos', 'success');
                    showNotification('Sistema PDF completamente operativo', 'success');
                } else {
                    logMessage(`‚ö†Ô∏è ${totalFiles - foundFiles} procesador(es) no disponible(s)`, 'warning');
                    showNotification(`${foundFiles}/${totalFiles} procesadores disponibles`, 'warning');
                }
            } catch (error) {
                logMessage('‚ùå Error al verificar procesadores PDF', 'error');
                showNotification('Error de conectividad', 'error');
            }
        }

        function displayFileStatus() {
            const fileStatusContainer = document.getElementById('fileStatus');
            fileStatusContainer.innerHTML = "";
            
            availableFiles.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = `file-item ${file.exists ? 'found' : 'missing'}`;
                
                const icon = document.createElement('span');
                icon.className = 'file-icon';
                icon.textContent = file.exists ? '‚úÖ' : '‚ùå';
                
                const fileName = document.createElement('span');
                fileName.className = 'file-name';
                fileName.textContent = file.name;
                
                fileItem.appendChild(icon);
                fileItem.appendChild(fileName);
                fileStatusContainer.appendChild(fileItem);
            });
        }

        function setExecuteButtonsState(enabled, onlyFor = null) {
            const executeButtons = document.querySelectorAll('.execute-btn');
            executeButtons.forEach(btn => {
                if (onlyFor && btn.getAttribute('onclick').includes(onlyFor)) {
                    btn.disabled = !enabled;
                } else if (!onlyFor) {
                    btn.disabled = !enabled;
                } else {
                    btn.disabled = true;
                }
            });
        }

        function setButtonProcessing(filename, processing) {
            const executeButtons = document.querySelectorAll('.execute-btn');
            executeButtons.forEach(btn => {
                if (btn.getAttribute('onclick').includes(filename)) {
                    if (processing) {
                        btn.classList.add('processing');
                        btn.textContent = '‚è≥ Procesando...';
                    } else {
                        btn.classList.remove('processing');
                        btn.textContent = '‚ñ∂Ô∏è Ejecutar';
                    }
                }
            });
        }

        async function runProcess(filename) {
            if (currentProcess) {
                showNotification('Ya hay un proceso ejecut√°ndose. Espere a que termine o det√©ngalo.', 'warning');
                return;
            }

            const fileExists = availableFiles.find(f => f.name === filename)?.exists;
            if (fileExists === false) {
                showNotification(`No se encontr√≥ el archivo: ${filename}`, 'error');
                logMessage(`‚ùå Archivo no encontrado: ${filename}`, 'error');
                return;
            }

            setExecuteButtonsState(false, filename);
            setButtonProcessing(filename, true);
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('fastProcessBtn').disabled = true;

            currentProcess = filename;
            
            let processType = '';
            if (filename.includes('ERP FC')) processType = 'ERP Facturas';
            else if (filename.includes('MUISKA')) processType = 'Facturas MUISKA';
            else if (filename.includes('DESPRENDIBLES')) processType = 'Desprendibles Bancarios';
            else if (filename.includes('ERP CONTABLE')) processType = 'ERP Comprobantes';
            else if (filename.includes('COMBINACION')) processType = 'FC Combinaci√≥n';
            else if (filename.includes('COMBINADO')) processType = 'CE Combinado';

            updateStatus(`üìÑ Procesando ${processType}`, 'processing');
            logMessage(`üìã Iniciando procesamiento de ${processType}`, 'info');

            try {
                const response = await fetch(`/run-process1/${encodeURIComponent(filename)}`, { 
                    method: 'POST' 
                });
                const data = await response.json();

                if (response.ok) {
                    logMessage(`‚úÖ ${processType}: ${data.message || 'Procesamiento completado'}`, 'success');
                    updateStatus(`‚úÖ ${processType} procesado correctamente`, 'success');
                    showNotification(`${processType} completado exitosamente`, 'success');
                } else {
                    logMessage(`‚ùå Error en ${processType}: ${data.error || 'Error desconocido'}`, 'error');
                    updateStatus(`‚ùå Error en ${processType}`, 'error');
                    showNotification(`Error: ${data.error}`, 'error');
                }
            } catch (error) {
                logMessage(`‚ùå Error de conexi√≥n en ${processType}`, 'error');
                updateStatus('‚ùå Error de conectividad', 'error');
                showNotification('Error de conexi√≥n', 'error');
            } finally {
                setExecuteButtonsState(true);
                setButtonProcessing(filename, false);
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('fastProcessBtn').disabled = false;
                currentProcess = null;
            }
        }

        function stopProcess() {
            if (currentProcess) {
                logMessage('üõë Proceso PDF detenido por el usuario', 'warning');
                updateStatus('üõë Procesamiento interrumpido', 'error');
                setExecuteButtonsState(true);
                setButtonProcessing(currentProcess, false);
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('fastProcessBtn').disabled = false;
                currentProcess = null;
                showNotification('Procesamiento detenido', 'warning');
            }
            
            if (fastProcessing) {
                fastProcessing = false;
                clearTimeout(fastProcessTimeout);
                logMessage('üõë Procesamiento masivo interrumpido', 'warning');
                updateStatus('üõë Procesamiento masivo detenido', 'error');
                document.getElementById('fastProcessBtn').disabled = false;
                showNotification('Procesamiento masivo detenido', 'warning');
            }
        }

        async function runAllProcesses() {
            if (currentProcess || fastProcessing) {
                showNotification('Ya hay un proceso ejecut√°ndose. Espere a que termine o det√©ngalo.', 'warning');
                return;
            }

            const availableProcesses = availableFiles.filter(f => f.exists).map(f => f.name);
            
            if (availableProcesses.length === 0) {
                showNotification('No hay procesadores PDF disponibles', 'warning');
                logMessage('‚ö†Ô∏è No hay procesadores disponibles', 'warning');
                return;
            }

            fastProcessing = true;
            fastProcessQueue = [...availableProcesses];
            fastProcessIndex = 0;

            document.getElementById('stopBtn').disabled = false;
            document.getElementById('fastProcessBtn').disabled = true;
            setExecuteButtonsState(false);

            updateStatus('‚ö° Procesamiento masivo PDF iniciado', 'processing');
            logMessage('üìã Iniciando procesamiento autom√°tico de todos los documentos', 'info');
            logMessage(`üìÑ Procesadores en cola: ${fastProcessQueue.length}`, 'info');
            showNotification('Iniciando procesamiento masivo', 'info');

            await processNextInQueue();
        }

        async function processNextInQueue() {
            if (!fastProcessing || fastProcessIndex >= fastProcessQueue.length) {
                fastProcessing = false;
                setExecuteButtonsState(true);
                document.getElementById('stopBtn').disabled = true;
                document.getElementById('fastProcessBtn').disabled = false;
                updateStatus('‚ö° Procesamiento masivo completado', 'success');
                logMessage('üéâ Procesamiento masivo PDF completado exitosamente', 'success');
                showNotification('Todos los procesos completados', 'success');
                return;
            }

            const filename = fastProcessQueue[fastProcessIndex];
            currentProcess = filename;
            
            setButtonProcessing(filename, true);
            updateStatus(`üìÑ Procesando ${fastProcessIndex + 1}/${fastProcessQueue.length}: ${filename}`, 'processing');
            logMessage(`‚ö° Ejecutando proceso ${fastProcessIndex + 1}/${fastProcessQueue.length}: ${filename}`, 'info');

            try {
                const response = await fetch(`/run-process1/${encodeURIComponent(filename)}`, { 
                    method: 'POST' 
                });
                const data = await response.json();

                if (response.ok) {
                    logMessage(`‚úÖ ${filename} completado: ${data.message || 'Proceso ejecutado correctamente'}`, 'success');
                } else {
                    logMessage(`‚ùå Error en ${filename}: ${data.error || 'Error desconocido'}`, 'error');
                }
            } catch (error) {
                logMessage(`‚ùå Error de conexi√≥n en ${filename}`, 'error');
            }

            setButtonProcessing(filename, false);
            currentProcess = null;
            fastProcessIndex++;

            if (fastProcessing) {
                fastProcessTimeout = setTimeout(() => {
                    processNextInQueue();
                }, 1000);
            }
        }

        function navigateTo(page) {
            window.location.href = page;
        }

        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            checkFileAvailability();
            logMessage('üìã Sistema de procesamiento PDF iniciado', 'success');

            const uploadForms = document.querySelectorAll('.upload-form');
            uploadForms.forEach(form => {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const processName = this.dataset.process;
                    const statusSpan = this.querySelector('.upload-status');
                    const fileInput = this.querySelector('input[type="file"]');
                    const submitBtn = this.querySelector('button[type="submit"]');
                    
                    if (!fileInput.files.length) {
                        statusSpan.textContent = '‚ùå Seleccione archivos';
                        statusSpan.style.color = '#ff3b3b';
                        showNotification('Debe seleccionar archivos para procesar', 'warning');
                        return;
                    }

                    const formData = new FormData();
                    for (let file of fileInput.files) {
                        formData.append('pdfFiles', file);  
                    }
                    formData.append('process', processName);

                    statusSpan.textContent = '‚è≥ Subiendo archivos...';
                    statusSpan.style.color = '#ffe600';
                    submitBtn.disabled = true;

                    try {
    const response = await fetch(`/upload-pdfs1/${encodeURIComponent(processName)}`, {  // ‚úÖ CORRECTO
        method: 'POST', 
        body: formData 
    });
                        const result = await response.json();
                        
                        if (response.ok) {
                            statusSpan.textContent = `‚úÖ ${result.message}`;
                            statusSpan.style.color = '#00ffb3';
                            logMessage(`üì§ Archivos subidos para ${processName}`, 'success');
                            showNotification('Archivos subidos exitosamente', 'success');
                            fileInput.value = '';
                        } else {
                            statusSpan.textContent = `‚ùå ${result.error}`;
                            statusSpan.style.color = '#ff3b3b';
                            logMessage(`‚ùå Error en subida de archivos: ${result.error}`, 'error');
                            showNotification('Error al subir archivos', 'error');
                        }
                    } catch (error) {
                        statusSpan.textContent = '‚ùå Error de conexi√≥n';
                        statusSpan.style.color = '#ff3b3b';
                        logMessage('‚ùå Error de conectividad al subir archivos', 'error');
                        showNotification('Error de conexi√≥n', 'error');
                    } finally {
                        submitBtn.disabled = false;
                        
                        setTimeout(() => {
                            statusSpan.textContent = '';
                        }, 5000);
                    }
                });
            });
        });

        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 'r':
                        e.preventDefault();
                        runAllProcesses();
                        break;
                    case 'l':
                        e.preventDefault();
                        clearLog();
                        break;
                    case 's':
                        e.preventDefault();
                        stopProcess();
                        break;
                }
            }
        });

        window.addEventListener('beforeunload', function(e) {
            if (currentProcess || fastProcessing) {
                e.preventDefault();
                e.returnValue = 'Hay procesamientos PDF en progreso. ¬øEst√°s seguro de que quieres salir?';
            }
        });
    </script>
</body>
</html>